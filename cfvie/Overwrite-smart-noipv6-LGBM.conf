[General]
#================================================================
#  Smart 内核总配置（由 OpenClash 覆写模块执行）
#================================================================

# 原始 YAML 文件路径
CONFIG_FILE = /etc/openclash/config/Overwrite-Clash.yaml

# Smart 内核
CORE_TYPE = Smart

#================================================================
#  DNS 相关（交由 YAML 完整管理，不做内部覆写）
#================================================================

# 禁止 fallback 覆写，DNS 统一由 YAML 控制
ENABLE_CUSTOM_DNS = 0
APPEND_DEFAULT_DNS = 0
APPEND_WAN_DNS = 0

# Fake-IP 缓存 & 过滤开关
STORE_FAKEIP = 1
CUSTOM_FAKEIP_FILTER = 1
CUSTOM_FAKEIP_FILTER_MODE = blacklist
FAKEIP_RANGE = 198.18.0.1/16

# DNS 不遵循 Clash 规则（Smart 推荐）
ENABLE_RESPECT_RULES = 0

#================================================================
#  IPv6 全面关闭（你当前环境需要禁 IPv6）
#================================================================
IPV6_ENABLE = 0
IPV6_DNS = 0

#================================================================
#  代理模式 / TUN 栈
#================================================================
EN_MODE = fake-ip-mix
DISABLE_UDP_QUIC = 0
ROUTER_SELF_PROXY = 1
STACK_TYPE = mixed
PROXY_MODE = rule

#================================================================
#  Smart 内核功能开启
#================================================================
AUTO_SMART_SWITCH = 1
SMART_STRATEGY = sticky-sessions

# LightGBM 模型加速
SMART_ENABLE_LGBM = 1
LGBM_AUTO_UPDATE = 1
LGBM_UPDATE_INTERVAL = 24
LGBM_CUSTOM_URL = https://github.com/vernesong/mihomo/releases/download/LightGBM-Model/Model-large.bin

# Smart 优化权重（示例，可按需修改）
SMART_POLICY_PRIORITY = Premium:0.9;SG:1.3;HK:1.5

#================================================================
#  GEO / GEOSITE / GEOASN 自动更新
#================================================================
ENABLE_GEOIP_DAT = 1
GEO_AUTO_UPDATE = 1
GEO_UPDATE_WEEK_TIME = *
GEO_UPDATE_DAY_TIME = 1

GEOIP_AUTO_UPDATE = 1
GEOIP_UPDATE_WEEK_TIME = *
GEOIP_UPDATE_DAY_TIME = 2

GEOSITE_AUTO_UPDATE = 1
GEOSITE_UPDATE_WEEK_TIME = *
GEOSITE_UPDATE_DAY_TIME = 3

GEOASN_AUTO_UPDATE = 1
GEOASN_UPDATE_WEEK_TIME = *
GEOASN_UPDATE_DAY_TIME = 4

#================================================================
#  Smart 其它优化
#================================================================
ENABLE_META_SNIFFER = 1
ENABLE_META_SNIFFER_CUSTOM = 1
ENABLE_META_SNIFFER_PURE_IP = 1

ENABLE_TCP_CONCURRENT = 1
ENABLE_UNIFIED_DELAY = 1

ENABLE_RULE_PROXY = 1
ENABLE_CUSTOM_CLASH_RULES = 1

#================================================================
#  CHNIP 自动更新（国内直连）
#================================================================
CHINA_IP_ROUTE = 1
CHNR_AUTO_UPDATE = 1
CHNR_UPDATE_WEEK_TIME = *
CHNR_UPDATE_DAY_TIME = 0

#================================================================
#  订阅自动写入 YAML（最重要）
#================================================================
SUB_INFO_URL = $EN_KEY

# 自动下载并覆盖 YAML
DOWNLOAD_FILE = url=https://raw.githubusercontent.com/AllenZhang45/rule/refs/heads/main/cfvie/Overwrite-Clash-noipv6.yaml, path=/etc/openclash/config/Overwrite-Clash-noipv6.yaml, cron=0 6 * * *, force=true

# 更新后自动重启 OpenClash
RESTART = true


#================================================================
#  Overwrite Section（订阅 URL 注入）
#================================================================
[Overwrite]
ruby_map_edit "$CONFIG_FILE" "['proxy-providers']" "provider" "['url']" "$EN_KEY"
